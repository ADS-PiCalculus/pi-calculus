"use strict";function parse_query_string(){var e={},t=window.location.search.split(/[?&]/);for(var s in t)if(""!=t[s]){var a=t[s].split("=");e[a[0]]=a[1]||!0}return e}function SimulationCtrl(e,t,s){function a(){return g&&clearInterval(g),g=setInterval(p.step,h),!0}function i(){o(p.DEFAULT_DELAY)}function o(e){return 0===arguments.length?h:(e=+e,l>e&&(e=l),e>c&&(e=c),e!==h&&(h=e,g&&a()),$("#speed-val").text(Math.ceil(100*(1-(e-l)/(c-l)))+"%"),this)}function r(e){return 0===arguments.length&&(e=d),0>e?n(-e):h+e>c?!1:(o(h+e),!0)}function n(e){return 0===arguments.length&&(e=d),0>e?r(-e):l>h-e?!1:(o(h-e),!0)}if(!(this instanceof SimulationCtrl))return new SimulationCtrl(e,t,s);var l=0,c=1e3,d=50,u=$(e),p=this,g,h=0;p.DEFAULT_DELAY=500,p.main=u,p.speedControl=u.children("#speed-control"),p.playBtn=u.children("#toggle-simulation"),p.playIcon=p.playBtn.children("i"),p.toggleSimulation=u.children("#toggle-simulation"),p.slowerSpeed=u.find("#slower-speed"),p.fasterSpeed=u.find("#faster-speed"),p.resetSpeed=u.find("#speed-val").parent(),this.start=function(){a(),p.playIcon.removeClass("play").addClass("pause")},this.stop=function(){g&&clearInterval(g),g=void 0,p.playIcon.removeClass("pause").addClass("play")},this.running=function(){return void 0!==g},this.step=function(){t()},this.stepDelay=o,this.increaseDelay=r,this.decreaseDelay=n,this.resetDelay=i,p.toggleSimulation.on("click",function(){$("#redex").sidebar("hide"),p.running()?p.stop():p.start()}),p.slowerSpeed.on("click",function(){p.increaseDelay()}),p.fasterSpeed.on("click",function(){p.decreaseDelay()}),p.resetSpeed.on("click",function(){p.resetDelay()})}window.demo_gist={url:"https://api.github.com/gists/6e54093b297c0f9df01d0c82f65b89f6",forks_url:"https://api.github.com/gists/6e54093b297c0f9df01d0c82f65b89f6/forks",commits_url:"https://api.github.com/gists/6e54093b297c0f9df01d0c82f65b89f6/commits",id:"6e54093b297c0f9df01d0c82f65b89f6",git_pull_url:"https://gist.github.com/6e54093b297c0f9df01d0c82f65b89f6.git",git_push_url:"https://gist.github.com/6e54093b297c0f9df01d0c82f65b89f6.git",html_url:"https://gist.github.com/6e54093b297c0f9df01d0c82f65b89f6",files:{"Counters.json":{filename:"Counters.json",type:"application/json",language:"JSON",raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/a5cdec909a878fba0749a8993bc210739c8092e5/Counters.json",size:22,truncated:!1,content:'{\n  "gravity": false\n}'},"Counters.pi":{filename:"Counters.pi",type:"text/plain",language:null,raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/6548f2ef50b234b70cfb16e9d16a4a11899073e5/Counters.pi",size:365,truncated:!1,content:"\u03bdc0,c1.( Z[c0] | Z[c1] | M1[c0,c1] )\n\nC[c,p] := c<p>\nZ[c] := c().Z[c]\nM[c1,c2] :=\n    c1(r).M[r,c2]\n  + c2(r).M[c1,r]\n  + tau.new t.(C[t,c1] | M[t,c2])\n  + tau.new t.(C[t,c2] | M[c1,t])\nM1[c1,c2] :=\n    c1<>.new c.( M2[c,c2] | C[c,c1] )\n  + c1(r).new c.( M1[r,c] | C[c,c2] )\nM2[c1,c2] :=\n    c2<>.new c.( M1[c1,c] | C[c,c2] )\n  + c2(r).new c.( M2[c,r] | C[c,c1] )\n"},"Couples.pi":{filename:"Couples.pi",type:"text/plain",language:null,raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/86990655385bbf14b30e17e197c1b65d492e490a/Couples.pi",size:207,truncated:!1,content:"new p,q.(M[p,q] | Gp[p] | Gq[q])\n\nM[p,q] := p(x).(PM[q,x] | M[p,q])\nGp[p] := tau.new w.(Aw[p,w] | Gp[p])\nGq[q] := tau.new z.(Bw[q,z] | Gq[q])\nBw[q,w] := q<w>.B[w]\nAw[q,w] := q<w>.A[w]\nPM[q,x] := q(y).N[x,y]\n"},"Hannenfass.json":{filename:"Hannenfass.json",type:"application/json",language:"JSON",raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/11fda76c3f6e1a9327903e507e33952ea2b70e98/Hannenfass.json",size:25,truncated:!1,content:'{\n  "showGlobals": true\n}'},"Hannenfass.pi":{filename:"Hannenfass.pi",type:"text/plain",language:null,raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/c2d4f10e84a530d9111f0417fdfbf3ba8f5ed15e/Hannenfass.pi",size:971,truncated:!1,content:"/* =================================\n * The Rumor Mill\n * at the Hannenfass bar\n * =================================\n * Coded by Thomas Schneider\n\nINITIAL STATE (INIT)\n---------------------------------- */\nnew t.(\n  Wise[a,b,s]\n| Naive[a,b]\n| Naive[a,b]\n| Naive[a,b]\n| Naive[a,b]\n| Naive[a,b]\n| Barman[a,b,t]\n)\n//PROCESS DEFINITION (DEFS)\n//----------------------------------\n//Barman\nBarman[a,b,t] :=\n    a<t>.B[a,b,t]\n  + tau.(Barman[a,b,t] | Naive[a,b])\n  + b<>.Barman[a,b,t]\nB[a,b,t] :=\n  a<t>.new t.Barman[a,b,t]\n//Wise Visitors\nWise[a,b,s] :=\n    a(t).W[a,b,s,t]\n  + b().Wise[a,b,s]\nW[a,b,s,t] :=\n    t<s>.Wise[a,b,s]\n  + t().Wise[a,b,s] + t<>.Wise[a,b,s]\n//Naive Visitors\nNaive[a,b] :=\n    a(t).N[a,b,t]\n  + b().Naive[a,b]\nN[a,b,t] :=\n    t(s).Wise[a,b,s]\n  + t<>.Naive[a,b]\n  + t().Naive[a,b]\n//EXPLANATION:\n//----------------------------------\n/*\n  a(t) - ask for table\n  t    - table-talk\n  s    - secret for more excitement\n  b    - beer for comical relief\n*/\n"},"List.json":{filename:"List.json",type:"application/json",language:"JSON",raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/a5cdec909a878fba0749a8993bc210739c8092e5/List.json",size:22,truncated:!1,content:'{\n  "gravity": false\n}'},"List.pi":{filename:"List.pi",type:"text/plain",language:null,raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/5b99d5d84202f9f1196cfb60f1e641654b93df84/List.pi",size:45,truncated:!1,content:"new a.L[a]\n\nL[x] := tau.new y.(B[x,y] | L[y])"},"Lists.json":{filename:"Lists.json",type:"application/json",language:"JSON",raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/a5cdec909a878fba0749a8993bc210739c8092e5/Lists.json",size:22,truncated:!1,content:'{\n  "gravity": false\n}'},"Lists.pi":{filename:"Lists.pi",type:"text/plain",language:null,raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/bd5603347b0cbf44d55ec1f4fcb3420848e47f73/Lists.pi",size:82,truncated:!1,content:"new a.A[a]\n\nA[x] := tau.(A[x] | L[x])\nL[x] := tau.new y,z.(B[x,y,z] | C[z] | L[y])"},"Ring.json":{filename:"Ring.json",type:"application/json",language:"JSON",raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/ee7615e48b7bbd53846de0219013be88f42aca7e/Ring.json",size:121,truncated:!1,content:'{\n  "gravity": false,\n  "palette": {\n    "S": "#2ca02c",\n    "M": "#1f77b4",\n    "T": "#ff7f0e",\n    "D": "#98df8a"\n  }\n}'},"Ring.pi":{filename:"Ring.pi",type:"text/plain",language:null,raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/db9b6eda3ef0727e3591a3fff984341cd5447228/Ring.pi",size:294,truncated:!1,content:"\u03bd master.(\n    M[master,master]\n  | T[master]\n  )\n\n// The master of the ring\nM[self, fst] :=\n  self().new next,data.(\n    M[self, next]\n  | S[next, fst, data]\n  | T[next]\n)\n\n// A slave\nS[self,next,data] :=\n  self().(\n    T[next]\n  | S[self, next,data]\n  | D[data]\n  )\n\n// The Token\nT[x] := x<>"},"Server.json":{filename:"Server.json",type:"application/json",language:"JSON",raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/1c74ace2b7c28690c54a1018c732c913744effdb/Server.json",size:43,truncated:!1,content:'{\n  "showLabels": true,\n  "gravity": true\n}'},"Server.pi":{filename:"Server.pi",type:"text/plain",language:null,raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/abae400d951456d2b16c4c6f0104b2bd31f47f44/Server.pi",size:179,truncated:!1,content:"new s. (S[s] | E[s])\n\nS[s] := s(x).\u03bdd.( A[x,d] | S[s] )\nE[s] := \u03c4.new m.(C[s, m] | E[s])\nC[s, m] := \u03c4.( Q[s,m] | C1[s,m])\nC1[s, m] := m(x).C[s, m]\nA[x,d] := x<d>\nQ[s,m] := s<m>"},"Servers.pi":{filename:"Servers.pi",type:"text/plain",language:null,raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/c46c8ef3899ca1dcc7de418d6c683316eefb6959/Servers.pi",size:212,truncated:!1,content:"new s. (S[s] | E[s])\n\nS[s] := s(x).\u03bdd.( A[x,d] | S[s] )\nE[s] := \u03c4.new m.(C[s, m] | E[s]) + \u03c4.\u03bds'.(S[s'] | E[s'] | E[s])\nC[s, m] := \u03c4.( Q[s,m] | C1[s,m])\nC1[s, m] := m(x).C[s, m]\nA[x,d] := x<d>\nQ[s,m] := s<m>"},"default.json":{filename:"default.json",type:"application/json",language:"JSON",raw_url:"https://gist.githubusercontent.com/bordaigorl/6e54093b297c0f9df01d0c82f65b89f6/raw/c6f410da27a5c1cd42e6439638508224a8031c13/default.json",size:26,truncated:!1,content:'{\n  "default": "Servers"\n}'}},"public":!0,created_at:"2017-02-26T21:26:23Z",updated_at:"2017-10-30T00:02:36Z",description:"Examples of pi-calculus programs",comments:0,user:null,comments_url:"https://api.github.com/gists/6e54093b297c0f9df01d0c82f65b89f6/comments",owner:{login:"bordaigorl",id:2098241,avatar_url:"https://avatars3.githubusercontent.com/u/2098241?v=4",gravatar_id:"",url:"https://api.github.com/users/bordaigorl",html_url:"https://github.com/bordaigorl",followers_url:"https://api.github.com/users/bordaigorl/followers",following_url:"https://api.github.com/users/bordaigorl/following{/other_user}",gists_url:"https://api.github.com/users/bordaigorl/gists{/gist_id}",starred_url:"https://api.github.com/users/bordaigorl/starred{/owner}{/repo}",subscriptions_url:"https://api.github.com/users/bordaigorl/subscriptions",organizations_url:"https://api.github.com/users/bordaigorl/orgs",repos_url:"https://api.github.com/users/bordaigorl/repos",events_url:"https://api.github.com/users/bordaigorl/events{/privacy}",received_events_url:"https://api.github.com/users/bordaigorl/received_events",type:"User",site_admin:!1},forks:[],history:[{user:{login:"bordaigorl",id:2098241,avatar_url:"https://avatars3.githubusercontent.com/u/2098241?v=4",gravatar_id:"",url:"https://api.github.com/users/bordaigorl",html_url:"https://github.com/bordaigorl",followers_url:"https://api.github.com/users/bordaigorl/followers",following_url:"https://api.github.com/users/bordaigorl/following{/other_user}",gists_url:"https://api.github.com/users/bordaigorl/gists{/gist_id}",starred_url:"https://api.github.com/users/bordaigorl/starred{/owner}{/repo}",subscriptions_url:"https://api.github.com/users/bordaigorl/subscriptions",organizations_url:"https://api.github.com/users/bordaigorl/orgs",repos_url:"https://api.github.com/users/bordaigorl/repos",events_url:"https://api.github.com/users/bordaigorl/events{/privacy}",received_events_url:"https://api.github.com/users/bordaigorl/received_events",type:"User",site_admin:!1},version:"adf63557ff5f521a0d7fbb8c0622301dbef784ab",committed_at:"2017-10-30T00:02:36Z",change_status:{total:36,additions:29,deletions:7},url:"https://api.github.com/gists/6e54093b297c0f9df01d0c82f65b89f6/adf63557ff5f521a0d7fbb8c0622301dbef784ab"},{user:{login:"bordaigorl",id:2098241,avatar_url:"https://avatars3.githubusercontent.com/u/2098241?v=4",gravatar_id:"",url:"https://api.github.com/users/bordaigorl",html_url:"https://github.com/bordaigorl",followers_url:"https://api.github.com/users/bordaigorl/followers",following_url:"https://api.github.com/users/bordaigorl/following{/other_user}",gists_url:"https://api.github.com/users/bordaigorl/gists{/gist_id}",starred_url:"https://api.github.com/users/bordaigorl/starred{/owner}{/repo}",subscriptions_url:"https://api.github.com/users/bordaigorl/subscriptions",organizations_url:"https://api.github.com/users/bordaigorl/orgs",repos_url:"https://api.github.com/users/bordaigorl/repos",events_url:"https://api.github.com/users/bordaigorl/events{/privacy}",received_events_url:"https://api.github.com/users/bordaigorl/received_events",type:"User",site_admin:!1},version:"8ce17dec0626d9b673fb01864ff2fe6321f6f9c3",committed_at:"2017-10-28T16:13:53Z",change_status:{total:5,additions:2,deletions:3},url:"https://api.github.com/gists/6e54093b297c0f9df01d0c82f65b89f6/8ce17dec0626d9b673fb01864ff2fe6321f6f9c3"},{user:{login:"bordaigorl",id:2098241,avatar_url:"https://avatars3.githubusercontent.com/u/2098241?v=4",gravatar_id:"",url:"https://api.github.com/users/bordaigorl",html_url:"https://github.com/bordaigorl",followers_url:"https://api.github.com/users/bordaigorl/followers",following_url:"https://api.github.com/users/bordaigorl/following{/other_user}",gists_url:"https://api.github.com/users/bordaigorl/gists{/gist_id}",starred_url:"https://api.github.com/users/bordaigorl/starred{/owner}{/repo}",subscriptions_url:"https://api.github.com/users/bordaigorl/subscriptions",organizations_url:"https://api.github.com/users/bordaigorl/orgs",repos_url:"https://api.github.com/users/bordaigorl/repos",events_url:"https://api.github.com/users/bordaigorl/events{/privacy}",received_events_url:"https://api.github.com/users/bordaigorl/received_events",type:"User",site_admin:!1},version:"97f288001fba470715050ac323f8e7c34a0e3ed6",committed_at:"2017-10-14T19:22:38Z",change_status:{total:7,additions:5,deletions:2},url:"https://api.github.com/gists/6e54093b297c0f9df01d0c82f65b89f6/97f288001fba470715050ac323f8e7c34a0e3ed6"},{user:{login:"bordaigorl",id:2098241,avatar_url:"https://avatars3.githubusercontent.com/u/2098241?v=4",gravatar_id:"",url:"https://api.github.com/users/bordaigorl",html_url:"https://github.com/bordaigorl",followers_url:"https://api.github.com/users/bordaigorl/followers",following_url:"https://api.github.com/users/bordaigorl/following{/other_user}",gists_url:"https://api.github.com/users/bordaigorl/gists{/gist_id}",starred_url:"https://api.github.com/users/bordaigorl/starred{/owner}{/repo}",subscriptions_url:"https://api.github.com/users/bordaigorl/subscriptions",organizations_url:"https://api.github.com/users/bordaigorl/orgs",repos_url:"https://api.github.com/users/bordaigorl/repos",events_url:"https://api.github.com/users/bordaigorl/events{/privacy}",received_events_url:"https://api.github.com/users/bordaigorl/received_events",type:"User",site_admin:!1},version:"2673c0dccea00f4d62fdc60610bfa5795b9e1067",committed_at:"2017-02-26T21:26:22Z",change_status:{total:122,additions:122,deletions:0},url:"https://api.github.com/gists/6e54093b297c0f9df01d0c82f65b89f6/2673c0dccea00f4d62fdc60610bfa5795b9e1067"}],truncated:!1};var NAME_REGEX=/^(.*)_(\d*)$/,sim;$(function(){function e(e){e?(sim.layout().gravity(C.g).charge(C.c).start(),$("#gravity").state("activate")):(sim.layout().gravity(x.g).charge(x.c).start(),$("#gravity").state("deactivate"))}function t(){var e=d3.select("body").select("#legend").selectAll("div").data(sim.legend(),function(e){return e.name}),t=e.enter().append("div");t.classed("legend-item",!0),t.append("span").classed("legend-color",!0).style("background-color",function(e){return e.color}),t.append("span").classed("legend-name",!0).text(function(e){return e.name}),e.exit().remove(),$("#current-config").text(sim.q.toPiCalc())}function s(){w={tau:k.select("#nodes").append("rect").classed("redex",!0).attr("width",sim.options.procWidth+4).attr("height",sim.options.procHeight+4),sender:k.select("#nodes").append("rect").classed("redex",!0).attr("width",sim.options.procWidth+4).attr("height",sim.options.procHeight+4),receiver:k.select("#nodes").append("rect").classed("redex",!0).attr("width",sim.options.procWidth+4).attr("height",sim.options.procHeight+4),channel:k.select("#nodes").append("circle").classed("redex",!0).attr("r",sim.options.nameSize+2)},a()}function a(){w.tau.style("display","none"),w.receiver.style("display","none"),w.sender.style("display","none"),w.channel.style("display","none"),sim.layout().resume()}function i(){var e=$("#redex");e.empty(),v.appendTo(e),v.find(".close").click(function(){e.sidebar("hide")})}function o(){var e=$("#redex"),s=sim.q.redexes(),r=sim.options.procWidth/2,n=sim.options.procHeight/2;i(),e.off("click").click(function(e){var i=$(e.target).attr("data");void 0!==i&&(i=parseInt(i),sim.q.makeReact(s[i]),a(),sim.update(),o(),t())}),e.off("mousemove").on("mousemove",function(e){var t=$(e.target).attr("data");if(void 0!==t){t=parseInt(t);var t=parseInt($(e.target).attr("data"));sim.layout().stop(),"tau"==s[t].type?w.tau.style("display","").attr("x",s[t].process.x-r-2).attr("y",s[t].process.y-n-2):(w.channel.style("display","").attr("cx",s[t].sender.action.channel.x).attr("cy",s[t].sender.action.channel.y),w.sender.style("display","").attr("x",s[t].sender.process.x-r-2).attr("y",s[t].sender.process.y-n-2),w.receiver.style("display","").attr("x",s[t].receiver.process.x-r-2).attr("y",s[t].receiver.process.y-n-2))}});for(var l in s)"tau"==s[l].type?$('<a class="item"></a>').text("Tau "+s[l].process.call.proc_name).prepend('<div class="ui empty circular label" style="background-color:'+s[l].process.color+'"></div>').attr("data",l).appendTo(e):$('<a class="item"></a>').html("Synch "+s[l].sender.process.call.proc_name+" \u2013 "+s[l].sender.action.channel.toPiCalc().replace(NAME_REGEX,"$1<sub>$2</sub>")+" \u2192 "+s[l].receiver.process.call.proc_name).attr("data",l).prepend('<div class="ui empty circular label" style="background-color:'+s[l].sender.process.color+'"></div>').prepend('<div class="ui empty circular label" style="margin-left:-.3em;background-color:'+s[l].receiver.process.color+'"></div>').appendTo(e)}function r(e){e&&sim.q.addCalls(e)&&sim.update()}function n(){clearTimeout(_),_=setTimeout(l,250)}function l(){$(k.node()).height(function(){return $(this).parent().innerHeight()}).width(function(){return $(this).parent().innerWidth()}).attr("width",function(){return $(this).width()}).attr("height",function(){return $(this).height()}),sim&&sim.translate([k.attr("width")/2,k.attr("height")/2])}function c(){i(),sim.next(sim.randomStrategy),t()}function d(e){suiteFromGist(e,u)}function u(e){$("#message-dialog").modal("hide");var t=decodeURIComponent(location.hash.slice(1))||(e?e["default"]:void 0);if(e&&e.successful&&t in e.programs){T=e;var s=$("#program-select").add("#suite .menu");s.empty();for(var a in e.programs)$('<a class="item" href="#'+encodeURIComponent(a)+'">'+a+"</a>").appendTo(s);$("#suite").show(),"gist"===e.source&&e.url?(p(e.id),$("#suite .menu").append('<div class="divider"></div>').append('<a class="item" target="_blank" href="'+e.url+'"><i class="github icon"></i>Open Gist</a>')):suiteSize(e)<=1&&$("#suite").hide(),g(e.programs[t])}else e?!e.successful||t in e.programs?e.reason||(e.reason="<p>The suite could not be loaded. Check your connection and the provided url.</p>",e.reason+="<p>Please note the only supported browsers are Firefox and Chrome.</p>"):e.reason="<p>Program '"+t+"' unknown.</p><p>Try with "+Object.keys(e.programs).map(function(e){return'<a href="#'+e+'">'+e+"</a>"}).join(" or ")+".</p>":e={error:"undefined",reason:"The program suite is undefined."},$("#message-dialog").find(".header").text("Loading Error"),$("#message-dialog").find(".content").html(e.reason),$("#message-dialog").modal("setting","closable",!1).modal("show")}function p(e){var t=localStorage.getItem("gist-history");return t?(t=t.split(","),void(t.indexOf(e)<0&&(t.push(e),localStorage.setItem("gist-history",t.join(","))))):void localStorage.setItem("gist-history",e)}function g(a,i){$("#validate-code").hide(),"string"==typeof a&&(i=a,a=T.programs[j]),void 0===i&&(i=a.sourceCode),j=a.name,$("#code-editor").val(i),$("#program-name").val(a.name);var r=void 0;try{r=parsePi.compileAndCheck(i),a.sourceCode=i}catch(n){if(n.location){$("#validate-code .header").text("Syntax Error at line "+n.location.start.line),$("#validate-code p").text(n.message);var c=n.location.start.offset,d=n.location.end.offset,u=$("#code-editor")[0];u.focus(),"undefined"!=typeof u.selectionStart?(u.selectionStart=c,u.selectionEnd=d):u.setSelectionRange&&u.setSelectionRange(c,d)}else $("#validate-code .header").text("Oooops, your code is not quite right!"),$("#validate-code p").text(n+". Make sure you normalised your code!");return $("#validate-code").removeClass("hidden").show(),void $("#sourcecode").sidebar("show")}k.selectAll("*").remove();var p=a.options.palette?{palette:a.options.palette}:void 0;sim=PiCalcSimulation(k,r,p),sim.init(function(){$("#simulation .dimmer").removeClass("active")}),$("#initial-config").text(sim.q.toPiCalc()),t(),o(),s(),e(a.options.gravity!==!1),k.classed("labels",a.options.showLabels===!0),$("#show-labels").state(a.options.showLabels===!0?"activate":"deactivate"),k.classed("globals",a.options.showGlobals===!0),$("#show-globals").state(a.options.showGlobals===!0?"activate":"deactivate"),a.options.showCode&&($("#source").state(1===+a.options.showCode?"activate":"deactivate"),$("#sourcecode").sidebar(1===+a.options.showCode?"show":"hide")),l()}function h(e){location.hash=e}function f(e){e=e!==!1,e?$("#open-suite .cancel, #open-suite .close").show():$("#open-suite .cancel, #open-suite .close").hide();var t=localStorage.getItem("gist-history");if(t)var s=$("#open-suite .from-gist.search").search({source:t.split(",").map(function(e){return{title:e}})});$("#open-suite").modal("setting","closable",e).modal("show")}function m(e){void 0===e&&(e={});var t=e.name||"New program",s=e.sourceCode||"0",a=e.options;void 0===a&&(a={});var i={source:"new",successful:!0,programs:{},"default":t};return i.programs[t]={sourceCode:s,name:t,options:a},i}function b(e,t){return"gist"!==T.source||t?(void 0===e&&(e=j),N+"?program="+encodeURIComponent(T.programs[e].sourceCode)):N+"?gist="+T.id+(e?"#"+encodeURIComponent(e):"")}$("#suite").dropdown({direction:"upward"}),$("#share").dropdown({direction:"upward"}),$(".program-menu .dropdown").dropdown(),$(".message .close").click(function(){$(this).closest(".message").transition("fade")}),$("#gravity").state().click(function(e,t){return sim.layout().gravity()>=C.g?sim.layout().gravity(x.g).charge(x.c).start():sim.layout().gravity(C.g).charge(C.c).start(),!0}),$("#config-panel .item").tab(),$("#show-labels").state().click(function(){k.classed("labels",!k.classed("labels"))}),$("#show-globals").state().click(function(){k.classed("globals",!k.classed("globals"))}),$("#search-bar").on("focusin",function(){$(this).width(200).addClass("focus")}).on("mouseenter",function(){$(this).width(200)}).on("mouseout",function(){$(this).width($(this).hasClass("focus")?200:100)}).on("focusout",function(){$(this).width(100).removeClass("focus error").find("input")}),$("#search-bar input").on("keyup",function(e){if($(this).parent().removeClass("error"),27==e.keyCode)this.blur();else{var t=$(this).val();if(t.length>0){var s=0;d3.selectAll("#graph #nodes .node.name").each(function(e){e.name==t||e.toPiCalc()==t?(s++,d3.select(this).classed("match",!0).classed("no-match",!1)):d3.select(this).classed("match",!1).classed("no-match",!0)}),d3.selectAll("#graph #nodes .node.seq").each(function(e){e.call.proc_name==t||e.call.toPiCalc()==t?(s++,d3.select(this).classed("match",!0).classed("no-match",!1)):d3.select(this).classed("match",!1).classed("no-match",!0)}),0==s&&$(this).parent().addClass("error")}else d3.selectAll("#graph #nodes .node").classed("match",!1).classed("no-match",!1)}}),$("#search-bar i.icon").click(function(){$("#search-bar input").val("").blur(),d3.selectAll("#graph #nodes .node").classed("match",!1).classed("no-match",!1)}),$("#collapse").state().click(function(e,t){var s=$("#search-bar input").val();if(0==s.length){sim.options.collapse=void 0;var a=d3.select("#graph #links");return void("none"===a.style("display")?a.style("display","inline"):a.style("display","none"))}sim.options.collapse=void 0!=sim.options.collapse?void 0:s,sim.layout().start()}),$("#shock").click(function(e,t){sim.layout().alpha(sim.layout().gravity()>=C.g?1.2:1.5)}),$("#sourcecode").sidebar("setting",{dimPage:!1,closable:!1,transition:"overlay"}),$("#source").state().click(function(e){$("#sourcecode").sidebar("toggle")}),$("#redex").sidebar("setting",{dimPage:!1,closable:!1,transition:"overlay"});var v=$('<div class="header item">Reactions <i class="icon close"></i></div>'),w={};$("#redex").on("mouseout",a),$("#step-simulation").click(function(){var e=$("#redex");return e.sidebar("is visible")?void e.sidebar("hide"):(o(),void e.sidebar("show"))});var y=0;$("#take-screenshot").click(function(){var e='<style type="text/css">\n           .node {}\n           .name {\n             fill: #5B7A8C;\n             stroke-width:1.2px;\n             stroke: white;\n           }\n           #lbl{display:none;}\n           .link {\n             stroke: #999;\n             stroke-width: 1.8pt;\n           }\n       </style>',t=$("svg#graph"),s=t.html(),a='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" height="'+t.height()+'" width="'+t.width()+'">'+e+s+"</svg>",i="data:image/svg+xml;base64,"+btoa(a),o=$("#screenshot .menu");0==y&&o.prepend('<div class="divider"></div>'),o.prepend('<a class="item" href="'+i+'" download="stargazer-'+y+'.svg"><i class="file image-outline icon"></i>Screenshot '+y+"</a>"),y++}),$("#screenshot").dropdown({direction:"upward",action:"nothing"}),$("#addcalls").click(function(e){var t=prompt("Insert the calls:");r(t)}),$("#help").click(function(e){$("#help-dialog").modal("show")});var _;$(window).resize(n);var C={g:.1,c:-400},x={g:1e-5,c:-30},k=d3.select("body").select("#graph"),S=new SimulationCtrl("#simulator-controls",c);S.resetDelay();var T,j;$(".program-menu .close").click(function(){$("#source").state().click()}),$("#open").click(function(){f()});var N="http://stargazer.emanueledosualdo.com";$("#share-prog").click(function(){$("#share-link-dialog .dropdown.button .menu").empty().append(Object.keys(T.programs).map(function(e){return'<div class="item'+(j==e?" current":"")+'"">'+e+"</div>"})),"gist"===T.source?($("#share-link-dialog .dropdown.button .menu").prepend('<div class="item" data-all="1">All</div><div class="divider"></div>'),$("#share-link-dialog .dropdown.button .menu .item[data-all]").click()):$("#share-link-dialog .dropdown.button .menu .item.current").click();var e=$("#share-link-dialog input").val();$("#share-link-dialog .facebook.button").attr("href","https://www.facebook.com/sharer/sharer.php?u="+e),$("#share-link-dialog .twitter.button").attr("href","https://twitter.com/home?status="+e),$("#share-link-dialog").modal("show")}),$("#share-link-dialog .dropdown.button").dropdown({action:"activate",onChange:function(e,t,s){$("#share-link-dialog input").val(b(s.attr("data-all")?void 0:t,"1"!==s.attr("data-all"))).select().focus()}}),$("#save-gist").click(function(e){$("#new-gist-dialog input").val(""),$("#new-gist-dialog .dimmer").addClass("active"),$("#new-gist-dialog .input").removeClass("error"),$("#new-gist-dialog .actions a.button").hide(),$("#new-gist-dialog").modal("show"),createGistFromSuite(T,function(e){$("#new-gist-dialog .dimmer").removeClass("active"),$("#new-gist-dialog .actions a.button").show(),$("#new-gist-dialog .actions a.open").attr("href",e.html_url),$("#new-gist-dialog .actions a.load").attr("href","?gist="+e.id),$("#new-gist-dialog input").val(e.html_url),p(e.id)},function(){$("#new-gist-dialog .dimmer").removeClass("active"),$("#new-gist-dialog .input").addClass("error"),$("#new-gist-dialog input").val("Creation of Gist failed, try again.")})}),$("#reload-code").click(function(){g($("#code-editor").val())}),$("#program-name").on("change",function(){var e=$("#program-name").val();T.programs[e]=T.programs[j],delete T.programs[j],T.programs[e].name=e,T["default"]===j&&(T["default"]=e),j=e,h(j)}),$(".program-menu .new").click(function(e){for(var t="New program",s=0;t in T.programs;)s++,t="New program"+s;T.programs[t]={sourceCode:"0",name:t,options:{gravity:sim.layout().gravity()>=C.g,showLabels:k.classed("labels"),showGlobals:k.classed("globals")}},h(t),$("#program-name").focus().select()}),$(".program-menu .del").click(function(e){if(suiteSize(T)>1){delete T.programs[j];var t=Object.keys(T.programs)[0];T["default"]===j&&(T["default"]=t),h(Object.keys(T.programs)[0])}else alert("You cannot delete the only program in a suite.")}),$("#open-suite .from-gist .button").click(function(){$("#open-suite").modal("hide");var e=$("#open-suite .from-gist input").val();location="?gist="+encodeURIComponent(e)}),$("#open-suite .from-gist .button").click(function(){$("#open-suite").modal("hide");var e=$("#open-suite .from-gist input").val(),t=e.match(gistUrlPattern);t&&($("#open-suite .from-gist .input").val(t[2]),e=t[2]),location="?gist="+encodeURIComponent(e)}),window.File&&window.FileReader?($("#open-suite .from-file .message").hide(),$("#open-suite .from-file .input").show()):($("#open-suite .from-file .message").show(),$("#open-suite .from-file .input").hide()),$("#open-suite .from-file .button").click(function(){var e=$("#open-suite .from-file input")[0].files;if(0===e.length)return void $("#open-suite .from-file input").click();e=e[0];var t=new FileReader,s;t.onload=function(e){try{s=JSON.parse(e.target.result)}catch(t){return void alert("This does not seem to be a valid Stargaze suite file")}u(s),$("#open-suite").modal("hide")};try{t.readAsText(e)}catch(a){alert("This does not seem to be a valid Stargaze suite file")}}),$("#save").click(function(){var e=JSON.stringify(T);$("#save").attr("href","data:application/json;base64,"+btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function t(e,s){return String.fromCharCode("0x"+s)})))}),$(window).on("hashchange",function(){T&&u(T)});var z=parse_query_string();if(z.demo||z.experimental?$(".experimental.button").show():$(".experimental.button").hide(),z.gist)d(decodeURIComponent(z.gist));else if(z.demo)d(demo_gist);else{var A=location.hash.slice(1),I=void 0;z.program?I=decodeURIComponent(z.program.replace(/\+/g,"%20")).replace(/\r\n/g,"\n"):z.showCode=!0;var L=m({name:A,sourceCode:I,options:{showCode:"0"!==z.showCode,gravity:"0"!==z.gravity,showLabels:"1"===z.showLabels,showGlobals:"1"===z.showGlobals}});u(L),z.program||z["new"]||f(!1)}});